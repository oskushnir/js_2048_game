var e={};e=class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.gameStatus="idle",this.score=0}moveLeft(e){if("playing"===this.gameStatus){let t=Array.from(e),l=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim())),r=[];e.forEach((e,t)=>{e.querySelectorAll("td").forEach((e,l)=>{e.textContent.trim().length>0&&r.push({rowIndex:t,cellIndex:l,cellNumber:parseInt(e.textContent.trim(),10)})})}),this.removeCell(e),r.forEach(({rowIndex:t,cellIndex:l,cellNumber:r})=>{let n=l;for(;n>0;){let l=e[t].querySelectorAll("td")[n-1];if(0===l.textContent.trim().length)n--;else{let a=parseInt(l.textContent);if(a===r){let e=a+r;l.textContent=e,l.className=`field-cell field-cell--${l.textContent}`,this.getScore(e),2048===e&&(this.gameStatus="win")}else{let l=e[t].querySelectorAll("td")[n];l.textContent=r,l.className=`field-cell field-cell--${r}`}return}}let a=e[t].querySelectorAll("td")[n];a.textContent=r,a.className=`field-cell field-cell--${r}`});let n=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim()));if(!l.every((e,t)=>e.every((e,l)=>e===n[t][l])))return this.findEmptyCells(e)}}moveRight(e){if("playing"===this.gameStatus){let t=Array.from(e),l=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim())),r=[];e.forEach((e,t)=>{let l=e.querySelectorAll("td");for(let e=l.length-1;e>=0;e--){let n=l[e];n.textContent.trim().length>0&&r.push({rowIndex:t,cellIndex:e,cellNumber:parseInt(n.textContent.trim(),10)})}}),this.removeCell(e),r.forEach(({rowIndex:t,cellIndex:l,cellNumber:r})=>{let n=l;for(;n<e[0].querySelectorAll("td").length-1;){let l=e[t].querySelectorAll("td")[n+1];if(0===l.textContent.trim().length)n++;else{let a=parseInt(l.textContent);if(a===r){let e=a+r;l.textContent=e,l.className=`field-cell field-cell--${l.textContent}`,this.getScore(e),2048===e&&(this.gameStatus="win")}else{let l=e[t].querySelectorAll("td")[n];l.textContent=r,l.className=`field-cell field-cell--${r}`}return}}let a=e[t].querySelectorAll("td")[n];a.textContent=r,a.className=`field-cell field-cell--${r}`});let n=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim()));if(!l.every((e,t)=>e.every((e,l)=>e===n[t][l])))return this.findEmptyCells(e)}}moveUp(e){if("playing"===this.gameStatus){let t=Array.from(e),l=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim())),r=[];e.forEach((e,t)=>{e.querySelectorAll("td").forEach((e,l)=>{e.textContent.trim().length>0&&r.push({rowIndex:t,cellIndex:l,cellNumber:parseInt(e.textContent.trim(),10)})})}),this.removeCell(e),r.forEach(({rowIndex:t,cellIndex:l,cellNumber:r})=>{let n=t;for(;n>0;){let t=e[n-1].querySelectorAll("td")[l];if(0===t.textContent.trim().length)n--;else{let a=parseInt(t.textContent);if(a===r){let e=a+r;t.textContent=e,t.className=`field-cell field-cell--${t.textContent}`,this.getScore(e),2048===e&&(this.gameStatus="win")}else{let t=e[n].querySelectorAll("td")[l];t.textContent=r,t.className=`field-cell field-cell--${r}`}return}}let a=e[n].querySelectorAll("td")[l];a.textContent=r,a.className=`field-cell field-cell--${r}`});let n=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim()));if(!l.every((e,t)=>e.every((e,l)=>e===n[t][l])))return this.findEmptyCells(e)}}moveDown(e){if("playing"===this.gameStatus){let t=Array.from(e),l=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim())),r=[];for(let t=e.length-1;t>=0;t--)e[t].querySelectorAll("td").forEach((e,l)=>{e.textContent.trim().length>0&&r.push({rowIndex:t,cellIndex:l,cellNumber:parseInt(e.textContent.trim(),10)})});this.removeCell(e),r.forEach(({rowIndex:t,cellIndex:l,cellNumber:r})=>{let n=t;for(;n<e.length-1;){let t=e[n+1].querySelectorAll("td")[l];if(0===t.textContent.trim().length)n++;else{let a=parseInt(t.textContent);if(a===r){let e=a+r;t.textContent=e,t.className=`field-cell field-cell--${t.textContent}`,this.getScore(e),2048===e&&(this.gameStatus="win")}else{let t=e[n].querySelectorAll("td")[l];t.textContent=r,t.className=`field-cell field-cell--${r}`}return}}let a=e[n].querySelectorAll("td")[l];a.textContent=r,a.className=`field-cell field-cell--${r}`});let n=t.map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim()));if(!l.every((e,t)=>e.every((e,l)=>e===n[t][l])))return this.findEmptyCells(e)}}getScore(e){return void 0!==e&&(this.score+=e),this.score}getState(e){let t=[];return e.forEach(e=>{let l=e.querySelectorAll("td"),r=[];l.forEach((e,t)=>{r.push(t)}),t.push(r)}),this.initialState=t,this.initialState}getStatus(){return this.gameStatus}start(e){this.gameStatus="playing";let t=!0;return e.forEach(e=>{e.querySelectorAll("td").forEach(e=>{e.textContent.trim().length>0&&(t=!1)})}),this.createCell(t)}restart(e){this.gameStatus="idle",this.score=0,this.removeCell(e),this.isGridFull=[]}getRandomIndex(){let e=[],t=Math.floor(4*Math.random()),l=Math.floor(4*Math.random()),r=Math.floor(4*Math.random()),n=Math.floor(4*Math.random());return t===r&&(t=Math.floor(4*Math.random()),r=Math.floor(4*Math.random())),l===n&&(l=Math.floor(4*Math.random()),n=Math.floor(4*Math.random())),t===l&&(t=Math.floor(4*Math.random()),l=Math.floor(4*Math.random())),r===n&&(r=Math.floor(4*Math.random()),n=Math.floor(4*Math.random())),e.push(t),e.push(l),e.push(r),e.push(n),e}getRandomCellNumber(){let e=Math.random(),t=[];return t.push(.1>=Math.random()?4:2),t.push(e<=.1?4:2),t}createCell(e){let t=this.getRandomIndex(),l=this.getRandomCellNumber(),r=null,n=null,a=[];return this.initialState.forEach((o,s)=>{o.forEach((o,i)=>{e&&(s===t[0]&&i===t[2]&&(r={rowIndex:t[0],cellIndex:t[2],cellNumber:l[0]},a.push(r)),s===t[1]&&i===t[3]&&(n={rowIndex:t[1],cellIndex:t[3],cellNumber:l[1]},a.push(n)))})}),a}createCellIfGameStarted(e,t){let l=Math.floor(Math.random()*e.length),r=e[l],n=t[l];e.splice(l,1),t.splice(l,1);let a=this.getRandomCellNumber(),o=null,s=[];return e.splice(l,1),t.splice(l,1),this.initialState.forEach((e,t)=>{e.forEach((e,l)=>{t===r&&l===n&&(o={rowIndex:t,cellIndex:l,cellNumber:a[0]},s.push(o))})}),s}findEmptyCells(e){let t=[],l=[];return e.forEach((e,r)=>{e.querySelectorAll("td").forEach((e,n)=>{0===e.textContent.trim().length&&(t.push(r),l.push(n))})}),this.createCellIfGameStarted(t,l)}isMovePossible(e){let t=[],l=[];e.forEach(e=>{if(4===e.length&&!e.includes("")&&t.length<4){let l=[];for(let r=0;r<e.length-1;r++)e[r]!==e[r+1]&&l.push(!0),3===l.length&&t.push(!0)}});for(let t=0;t<e.length-1;t++){let r=e[t],n=e[t+1],a=[];if(4===r.length&&4===n.length&&!r.includes("")&&!n.includes(""))for(let e=0;e<r.length;e++)r[e]!==n[e]&&a.push(!0),4===a.length&&l.push(!0)}4===t.length&&3===l.length&&(this.gameStatus="lose")}removeCell(e){e.forEach(e=>{e.querySelectorAll("td").forEach(e=>{e.textContent.length>0&&(e.className="field-cell",e.innerHTML="")})})}changeMessage(e){"playing"===this.gameStatus&&e.classList.add("hidden"),"idle"===this.gameStatus&&e.classList.remove("hidden")}};const t=document.querySelector(".controls"),l=t.querySelector(".game-score"),r=t.querySelector(".button"),n=document.querySelector("table").querySelector("tbody"),a=n.querySelectorAll("tr"),o=document.querySelector(".message-container"),s=o.querySelector(".message-lose"),i=o.querySelector(".message-win"),c=o.querySelector(".message-start");s.classList.add("hidden"),i.classList.add("hidden");const d=new e;function h(e){if(void 0!==e){let t=e[0];a.forEach((e,l)=>{e.querySelectorAll("td").forEach((e,r)=>{t.rowIndex===l&&t.cellIndex===r&&(e.classList.add(`field-cell--${t.cellNumber}`),e.textContent=t.cellNumber)})})}}d.getState(a),r.addEventListener("click",()=>{if(r.hasAttribute("class","start")&&"Start"===r.textContent){r.classList.remove("start"),r.classList.add("restart"),r.textContent="Restart";let e=d.start(a);d.changeMessage(c),a.forEach((t,l)=>{t.querySelectorAll("td").forEach((t,r)=>{if(2===e.length){let n=e[0],a=e[1];n.rowIndex===l&&n.cellIndex===r&&(t.classList.add(`field-cell--${n.cellNumber}`),t.textContent=n.cellNumber),a.rowIndex===l&&a.cellIndex===r&&(t.classList.add(`field-cell--${a.cellNumber}`),t.textContent=a.cellNumber)}})})}else r.hasAttribute("class","restart")&&"Restart"===r.textContent&&(r.classList.remove("restart"),r.classList.add("start"),r.textContent="Start",d.restart(a),l.textContent=0,i.classList.add("hidden"),s.classList.add("hidden"),d.changeMessage(c))}),new MutationObserver(()=>{let e=Array.from(a).map(e=>Array.from(e.querySelectorAll("td")).map(e=>e.textContent.trim()));d.isMovePossible(e),"lose"===d.gameStatus&&s.classList.remove("hidden")}).observe(n,{childList:!0,subtree:!0}),document.addEventListener("keydown",e=>{if(e.preventDefault(),"playing"===d.getStatus())switch(e.key){case"ArrowLeft":h(d.moveLeft(a));break;case"ArrowRight":h(d.moveRight(a));break;case"ArrowUp":h(d.moveUp(a));break;case"ArrowDown":h(d.moveDown(a))}l.textContent=d.getScore(),"win"===d.getStatus()&&i.classList.remove("hidden")});
//# sourceMappingURL=index.090d6925.js.map
